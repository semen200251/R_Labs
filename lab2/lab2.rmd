---
title: "lab2"
author: "Semen Khomets"
date: "2022-10-31"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```
### Задание 13.
Используйте файл Air_flows.txt
Напишите функцию, которая создает именованный список, в котором имена - это названия городов, значения – общее количество пассажиров прибывших в города. Напишите функцию, которая по названию города выводит список тех городов, в которые осуществляются перевозки из этого города.

Устанавливаю необходимые библиотеки и абсолютный путь до директории с данными:
```{r warning=FALSE}
library("readxl")
library(plyr)
library(readr)
library(dplyr)

setwd("C:\\Proteomics\\secondLab\\data")
```
Открываю файл
```{r warning=FALSE}
df <- read_excel("data\\air_flows.xlsx")
```
Функция выводит на экран сразу и список тех городов, в которые осуществляются перевозки из этого города и общее количество пассажиров прибывших в города. Одна функция для двух заданий, чтобы оптимизировать память и время. Сначала функция для удобства удаляет из датафрейма ненужные строки и столбцы, затем переименовывает столбцы. Далее происходит поиск по датафрейму городов, в которые осуществляются перевозки из принятого на вход города. Затем небольшой костыль, чтобы 2000 тоже считалось числом. Затем создаётся новая таблица с двумя столбцами, в первом названия городов, во втором будет количество пассажиров, прибивших в эти города за 3 года. В цикле суммируются для каждого города количество пассажиров за каждый год. В конце выводятся и названия городов, в которые осуществляется перевозка из заданного города и количество пассажиров, прибивших во все города за 3 года:
```{r warning=FALSE}
myFunc1 <- function(data){
  
  df <- df[-c(1:4), ]
  colnames(df) <- c(df[1, "2.33 ПЕРЕВОЗКИ ПАССАЖИРОВ МЕЖДУ ОТДЕЛЬНЫМИ ПАРАМИ ГОРОДОВ ВО ВНУТРЕННЕМ СООБЩЕНИИ"],df[1,"...2"],df[1,"...3"],df[1,"...4"],df[1,"...5"])
  df <- df[-c(1), ]
  x=df$Город2[df$Город1 %in% c(data)]
  
  df <- transform(df,`2000` = as.numeric(`2000`))
  
  cities <- distinct(df,Город2)
  citiesSum <- list(c(0))
  
  for(i in 1:nrow(cities)){
    citiesSum[[i]] <- c(sum(df$`X2000`[df$Город2 %in% c(cities[i,"Город2"])])+
                          sum(df$`X2005`[df$Город2 %in% c(cities[i,"Город2"])])+
                          sum(df$`X2006`[df$Город2 %in% c(cities[i,"Город2"])]))
  }
  
  cities$count <- c(citiesSum)
  
  print(x)
  print(cities)
}
```

Пример для города Москва: 
```{r warning=FALSE}
myFunc1("Москва")
```

### Задание 26.
Используйте файл Payment_and_value_of_Care-Hospital.csv
Напишите функцию, которая на вход принимает название города, округа или штата, а на выход выдает количество больниц в нем, процент детских больниц и процент психиатрических больниц. Если значение переданное на вход функции не является городом, округом или штатом, то должно функция должна выдавать соответствующее сообщение об ошибке. Обратите внимание, что функция должна принимать на вход только одно значение.



```{r warning=FALSE}
df <- read_csv(file = "data\\Payment_and_Value_of_Care-Hospital.csv")
```

Функция проходит по дата фрейму и находит в списке городов, штатов, округов совпадения с полученной на вход строкой, причем если совпадения найдены хотя бы для какого-то из списков, то для остальных списков результаты поиска уже не учитываются на случай совпадения названия штата и города, например. Если ни одного совпадения найдено не было, то функция выводит в консоль сообщение об ошибке, если совпадения найдены, то функция возвращается количество совпадений:
```{r warning=FALSE}
myFunc <- function(data){
  
  df <- distinct(df,`Facility ID`, City, State, `County Name`)
  
  x=df$`Facility ID`[df$City %in% c(data)]
  if (!length(x)){
    x=df$`Facility ID`[df$State %in% c(data)]
    if (!length(x)){
      x=df$`Facility ID`[df$`County Name` %in% c(data)]
    }
  }
  if(length(x)==0){
    return ("Incorrect input")
  }
  return(length(x))
}
```
Пример для HOUSTON
```{r warning=FALSE}
myFunc("HOUSTON")
```
